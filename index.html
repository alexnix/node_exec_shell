<!DOCTYPE html>
<html>
	<head>
		<title>USSD Transactions</title>
		
		<!-- Loaded From node_modules -->
		<link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="style.css">
		<script src="angular/angular.min.js"></script>

		<!-- Loaded From public -->
		<script src="socket.io.js"></script>
		
		<script type="text/javascript">
		var app = angular.module('app', []);

		app.factory('socket', function ($rootScope) {
		  var socket = io.connect();
		  return {
		    on: function (eventName, callback) {
		      socket.on(eventName, function () {  
		        var args = arguments;
		        $rootScope.$apply(function () {
		          callback.apply(socket, args);
		        });
		      });
		    },
		    emit: function (eventName, data, callback) {
		      socket.emit(eventName, data, function () {
		        var args = arguments;
		        $rootScope.$apply(function () {
		          if (callback) {
		            callback.apply(socket, args);
		          }
		        });
		      })
		    }
		  };
		});

		app.controller('TabelCtrl', ['$scope', '$http', 'socket', function($scope, $http, socket){

			socket.on('transaction', function(d){
				if ($scope.transactions){
					d.isNew = true;
					setTimeout(function(){
						d.isNew = false;
					}, 100);
					$scope.transactions.push(d);
				}
			});

			$scope.predicate = 'Date';
			$scope.reverse = true;
			$scope.order = function(predicate) {
				$scope.reverse = ($scope.predicate === predicate) ? !$scope.reverse : false;
				$scope.predicate = predicate;
			};

			$http.get('/api/transactions').then(function(res){
				$scope.transactions = res.data;
			});
		}]);

		</script>
	</head>
	<body ng-app="app">
		<div class="table-wrapper" ng-controller="TabelCtrl">
			<table class="table">
				<thead>
					<tr>
						<td ng-click="order('Date')">
							Date
							<span class="sortorder" ng-show="predicate === 'Date'" ng-class="{reverse:reverse}"></span>
						</td>
						<td ng-click="order('First_Argument')">
							First Argument
							<span class="sortorder" ng-show="predicate === 'First_Argument'" ng-class="{reverse:reverse}"></span>
						</td>
						<td ng-click="order('Second_Argument')">
							Second Argument
							<span class="sortorder" ng-show="predicate === 'Second_Argument'" ng-class="{reverse:reverse}"></span>
						</td>
						<td ng-click="order('Status')">
							Status
							<span class="sortorder" ng-show="predicate === 'Stats'" ng-class="{reverse:reverse}"></span>
						</td>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="transaction in transactions | orderBy:predicate:reverse" ng-class="{
						'new': transaction.isNew
					}">
						<td>{{transaction.Date | date:'medium'}}</td>
						<td>{{transaction.First_Argument}}</td>
						<td>{{transaction.Second_Argument}}</td>
						<td>
							<i class="fa fa-times" ng-hide="transaction.Status"></i>
							<i class="fa fa-check" ng-shoe="transaction.Status"></i>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</body>
</html>